<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فرم ثبت اطلاعات</title>

    <!-- jQuery (Required) -->
    <script src="/static/js/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="/static/css/persian-datepicker.min.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <!-- Add Persian calendar links -->
    <script src="/static/js/persian-date.min.js"></script>
    <script src="/static/js/persian-datepicker.min.js"></script>
    


</head>
<body>
    <h1>فرم ثبت اطلاعات</h1>
    <div class="form-container">
        <form action="submit-form" method="POST" onsubmit="validateForm(event)">
            {% for section, fields in form_structure.items() %}
                <h2>{{ section }}</h2>
                <div class="form-row">
                    {% for field, options in fields.items() %}
                        <div class="form-column">
                            <label for="{{ field }}">
                                {{ field }}
                                {% if (section == "اطلاعات هویتی" or section == "اطلاعات دسترسی") and field in [نام و نام خانوادگی", "کد ملی", "تاریخ تولد", "جنسیت", "وضعیت تاهل", "شماره موبایل"] %}
                                    <span class="required">*</span>
                                {% endif %}
                            </label>

                            {% if options == "text" %}
                                <input type="text" id="{{ field }}" name="{{ field }}">
                            {% elif options == "number" %}
                                <input type="number" id="{{ field }}" name="{{ field }}">
                            {% elif options == "date" %}
                                <input type="text" id="{{ field }}" name="{{ field }}" class="datepicker" required>
                            {% elif options == "textarea" %}
                                <textarea id="{{ field }}" name="{{ field }}"></textarea>
                            {% elif options is mapping or options is sequence %}
                                <select id="{{ field }}" name="{{ field }}">
                                    {% if section == "اطلاعات شخصی" and field in ["جنس", "وضعیت تاهل"] %} required {% endif %}
                                    {% if field == "اطلاعات آدرس" %} onchange="toggleCountryField(this)" {% endif %}>
                                    <option value="" disabled selected>انتخاب کنید</option>
                                    {% for option in options %}
                                        <option value="{{ option }}">{{ option }}</option>
                                    {% endfor %}
                                </select>

                                <!-- Toggle field for "اطلاعات آدرس" -->
                                {% if field == "اطلاعات آدرس" %}
                                    <div id="country-details" style="display: none;">
                                        <label for="country-name">نام شهرستان:</label>
                                        <input type="text" id="country-name" name="country_name">
                                    </div>
                                {% endif %}
                            {% endif %}

                            <!-- Error message container below each field -->
                            <div class="error-message" id="{{ field }}-error"></div>
                        </div>
                    {% endfor %}
                </div>
                <hr>
            {% endfor %}
            <button type="submit">ارسال</button>
            <a href="{{ url_for('view_data') }}" class="view-data-btn">
                <button type="button">مشاهده داده‌ها</button>
            </a>
        </form>        
    </div>
    <footer>&copy; 2025 - سیستم ثبت اطلاعات</footer>
    <script>
        $(document).ready(function() {
          // Initialize the Persian Datepicker
          $('.datepicker').persianDatepicker({
            format: 'YYYY/MM/DD',
            altFormat: 'YYYY/MM/DD',
            calendar: { persian: true },
            autoClose: true, // Automatically close after date selection
            onSelect: function(date) {
              console.log("Date selected: " + date);
            }
          });
    
          console.log("Persian Datepicker initialized!");
        });
    </script>

    <script src="/static/js/form-submit.js" defer></script>
    <script src="/static/js/form-logic.js" defer></script>
</body>

</html>
